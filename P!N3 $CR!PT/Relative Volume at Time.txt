// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© Julien_Eche

//@version=6
indicator("Relative Volume at Time", "RVOL", overlay = false)

import TradingView/ta/7

// User Inputs
anchorTimeframeInput = input.timeframe("1D", "Anchor Timeframe", tooltip = "When the chart timeframe is greater than or equal to the `Anchor Timeframe`, the indicator will use the last `Length` bars for its calculations.")
lengthInput          = input.int(10, "Length", minval = 1)
calculationModeInput = input.string("Regular", "Calculation Mode", options = ["Cumulative", "Regular"])
adjustRealtimeInput  = input.bool(true, "Adjust Unconfirmed", tooltip = "If enabled, the volume on bars that have not yet closed will be adjusted based on the previous volume data for the current session, extrapolating the expected volume at the end of the period.")

// Color Options
colorUp   = color.new(#26a69a, 30)
colorDown = color.new(#ef5350, 30)
colorHline = color.gray

// Relative Volume Calculation
[currentVolume, pastVolume, _] = ta.relativeVolume(lengthInput, anchorTimeframeInput, calculationModeInput == "Cumulative", adjustRealtimeInput)

relVolRatio = currentVolume / pastVolume

// Plot the Relative Volume Ratio
plot(relVolRatio, "Relative Volume Ratio", color = relVolRatio > 1 ? colorUp : colorDown, style = plot.style_columns, histbase = 1)
hline(1, "Base Line", color = color.new(colorHline, 50))

// Handle cumulative volume error check
var float cumVol = 0.
cumVol += nz(volume)

if barstate.islast and cumVol == 0
    runtime.error("The data vendor does not provide volume data for this symbol.")
